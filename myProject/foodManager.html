<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    .container1 {
      padding: 20px;
    }

    .input-group {
      margin-top: 30px;
      width: 50%;
    }

    .form-control {
      width: 30%;
    }

    td>img {
      width: 60%;
      height: 100px;
      border-radius: 10px;
    }
  tr {
   position: relative;
  }

  .center{
    position: absolute;
    top: 40px;
  }
  #center{
    text-align: center;
  }
  #borderLine{
    border-top: 1px solid #000000;
  }

  </style>
</head>

<body class="index-page">


  <!-- Hero Section -->
  <div id="header"></div>
  <main>
    <div class="container1">
      <h1 class='mt-5 mb-4 ms-5 opacity-75' id="textFood ">음식 메뉴 관리</h1>
      <div class="row justify-content-md-center">
      <div class="input-group mb-5 w-50 ms-5">
        <span class="input-group-text ">메뉴 이름</span>
        <input type="text" id="menuName" class="form-control  w-10" aria-label="Sizing example input"
          aria-describedby="inputGroup-sizing-default">
        <span class="input-group-text">이미지 경로</span>
        <input type="text" id="menuImg" class="form-control w-25" aria-label="Sizing example input"
          aria-describedby="inputGroup-sizing-default">
        <button class="btn btn-primary" id="addBtn">등록</button>
      </div>
    </div>
    <div id="borderLine">
      <h3 class="mt-4 mb-4 opacity-75" id="center">음식 목록</h3>
      <div class="row justify-content-md-center">
      <table class="table table-striped w-75">
        <thead>
          <tr class="something">
            <th class="col-md-1">No</th>
            <th class="col-md-2">사진</th>
            <th class="col-md-2">이름</th>
            <th class="col-md-3">이미지 경로</th>
            <th class="col-md-1">삭제</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
     
      <nav aria-label="..." id="paging" class="d-flex justify-content-center">
       
      </nav>
    
      </div>
      
    </div>
    </div>
    <button id="resultBtn">결과확인</button>
  </main>
  <div id="footer"></div>

  <script src="js/ready.js"></script>
  <script>
    let foodList = JSON.parse(localStorage.getItem('foodList'));
    function makeRow(current=1) {
      
      let tbody = document.querySelector('tbody')
      tbody.innerHTML = ''
      for (let ary = foodList.length-(current-1)*5; ary > foodList.length-current*5; ary--) {
        if(ary-1 >= 0){
        tbody.innerHTML += `<tr class="something">
            <th class="col-md-1"><span class='center' id='center'>${ary}<span></th>
            <td class="col-md-2"><img src=${foodList[ary-1].src}></td>
            <td class="col-md-2"><span class='center'>${foodList[ary-1].name}</span></td>
            <td class="col-md-3"><span class='center'>${foodList[ary-1].src}</span></td>
            <td class="col-md-1"><button class="btn btn-danger removeBtn center">삭제</button></td>
          </tr>`
        }
      }
    }

    let addBtn = document.querySelector('#addBtn')
    addBtn.addEventListener('click', function () {
      let menuName = document.querySelector('#menuName');
      let menuImg = document.querySelector('#menuImg');
      currentPage = document.querySelector('.active').textContent
      if (menuName.length < 0 && menuImg.length < 0) {
        alert('값을 입력하세요')
      } else {
        let foodObj = {
          name: menuName.value,
          src: menuImg.value
        }
        foodList.push(foodObj);
        console.log(foodList)
        localStorage.setItem('foodList',JSON.stringify(foodList))
        makeRow();
        lastPage(currentPage)
        alert('등록이 완료되었습니다.')
      }
    })

    document.addEventListener("DOMContentLoaded", function () {
      makeRow();
    });
    let removeBtn ='';

    document.querySelector('table').addEventListener('click',remove)
    
    function remove() {
      removeBtn = document.querySelectorAll('.removeBtn')
      currentPage = document.querySelector('.active').textContent
      removeBtn.forEach(function(item,idx){
        item.addEventListener('click',function(){
          foodList.splice(foodList.length-idx-1,1);
          localStorage.setItem('foodList',JSON.stringify(foodList))
          makeRow();
        })
      })
      lastPage(currentPage)
    }

    function lastPage(currentPage=1){
      let lastPage = Math.ceil(foodList.length/5)
      let paging = document.querySelector('#paging')
      str= ''
      str += ` <ul class="pagination yedam">
                            <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                            </li>`;
      for(let i = 1; i<=lastPage; i++){
        str += `<li class="page-item ${i == currentPage ? 'active':''}" aria-current=${i==1?'page':''}><a class="page-link" href="javascript:void(0);">${i}</a></li>`
      }
      str += `<li class="page-item">
                            <a class="page-link" href="#">Next</a>
                           </li></ul>`
      paging.innerHTML=str;
    }
    lastPage();
    document.querySelector('#paging').addEventListener('mouseover',function(){
      let pagingBtn = document.querySelectorAll('.page-item');     
      pagingBtn.forEach(function(item,idx){
        item.addEventListener('click',function(){
          let current = item.querySelector('li>a').textContent
          lastPage(current);
          makeRow(current)
        })
      })
    })
  </script>
</body>

</html>